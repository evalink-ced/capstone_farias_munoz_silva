{% extends "../base2.html" %} {% load crispy_forms_tags%} {% load static %}
{%block content%}

<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- codigo css-->
    <link
      rel="stylesheet"
      type="text/css"
      href='{% static "CSS/body_nav.css"%}'
    />
    <link
      rel="stylesheet"
      type="text/css"
      href='{% static "CSS/loader.css"%}'
    />
    <link
      rel="stylesheet"
      type="text/css"
      href='{% static "CSS/obs-denegar.css"%}'
    />

    <!--html meta-->
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>Formulario Pendiente</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css"
    />
    <!--Datatable-->
    <script defer src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script
      defer
      src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"
    ></script>
    <script
      defer
      src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"
    ></script>
    <script src='{% static "assets/js/datatable_h.js" %}'></script>
  </head>

  <style>
    .observa {
      border-radius: 15px;
      /* Ajusta este valor según el grado de redondez que desees */
      border: 1px solid #ccc;
      /* Ajusta el color del borde si es necesario */
      padding: 10px;
      /* Ajusta el padding interno para un mejor diseño */
    }
  </style>

  <body>
    <div
      class="col-md-4 mx-auto content"
      style="position: absolute; z-index: 2"
    ></div>
    <h1>Solicitudes Pendientes</h1>
    <div class="container-fluid">
      <div class="row">
        <div class="col-12">
          <table
            id="myTable"
            class="table table-striped table-bordered display w-100"
          >
            <thead class="thead-dark">
              <tr>
                <th>email</th>
                <th>motivo</th>
                <th>jornada</th>
                <th>Dia solicitado</th>
                <th>fecha de solicitud</th>
                <th>hora inicio</th>
                <th>hora termino</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              {% if formularios %} {% for c in formularios %}
              <tr>
                <td>{{ c.user.email }}</td>
                <td>{{ c.motivo }}</td>
                <td>{{ c.jornada.jornada }}</td>
                <td>{{ c.fecha }}</td>
                <td>{{ c.created_at }}</td>
                <td>{{ c.hora_ingreso }}</td>
                <td>{{ c.hora_regreso }}</td>
                <td>
                  <div style="display: flex; justify-content: space-between">
                    <div>
                      <form
                        id="form_aceptar_{{ c.id }}"
                        class="formulario"
                        method="post"
                        action="{% url 'aceptar_formulario' c.id %}"
                      >
                        {% csrf_token %}
                        <button type="submit" class="btn btn-success">
                          Aceptar
                        </button>
                      </form>
                    </div>
                    <div>
                      <button
                        type="button"
                        class="btn btn-danger"
                        id="denegar-btn-{{ c.id }}"
                        onclick="mostrarObservacion('{{ c.id }}')"
                      >
                        Denegar
                      </button>
                    </div>
                  </div>

                  <div
                    id="formulario_observacion_{{ c.id }}"
                    class="obsdenegar"
                    style="display: none"
                  >
                    <form
                      id="observacion_form_{{ c.id }}"
                      class="formulario"
                      method="post"
                      action="{% url 'denegar_formulario' c.id %}"
                    >
                      {% csrf_token %}
                      <textarea
                        name="denegacion"
                        class="observa"
                        id="denegacion_{{ c.id }}"
                        placeholder="Indique el motivo del rechazo de la solicitud"
                        cols="20"
                        rows="10"
                        maxlength="100"
                        required
                      ></textarea>
                      <p>
                        <span id="contador2_{{ c.id }}">0</span> / 100
                        caracteres
                      </p>
                      <button
                        type="submit"
                        class="btn btn-primary"
                        id="enviar-btn-{{ c.id }}"
                      >
                        Enviar
                      </button>
                      <button
                        type="button"
                        class="btn btn-danger"
                        onclick="ocultarObservacion('{{ c.id }}')"
                      >
                        Cancelar
                      </button>
                    </form>
                  </div>
                </td>
              </tr>
              {% endfor %} {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="content-loader" id="loader" style="display: none">
      <div class="loader" id="loader"></div>
      <div class="cargando">Cargando...</div>
    </div>

    <script>
      function mostrarObservacion(id) {
        const observacionDiv = document.getElementById(
          `formulario_observacion_${id}`
        );
        observacionDiv.style.display = "block";

        const textarea = document.getElementById(`denegacion_${id}`);
        const contador = document.getElementById(`contador2_${id}`);

        textarea.addEventListener("input", function () {
          const longitudTexto = textarea.value.length;
          contador.textContent = longitudTexto;

          if (longitudTexto > 100) {
            textarea.value = textarea.value.slice(0, 100);
            contador.textContent = 100;
          }
        });
      }

      function ocultarObservacion(id) {
        const observacionDiv = document.getElementById(
          `formulario_observacion_${id}`
        );
        observacionDiv.style.display = "none";
      }
    </script>

    <!--  IMPORTACIÓN DE JS JQUERY -->
    <script src='{% static "assets/js/jquery/jquery-3.6.4.min.js" %}'></script>
    <script src='{% static "assets/js/jquery/jquery-ui.js" %}'></script>
    <script src='{% static "assets/js/a-d.js" %}'></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <!--  IMPORTACIÓN DE JS DE BOOSTRAP -->
    <script src='{% static "assets/js/bootstrap/bootstrap.bundle.min.js" %}'></script>
  </body>
</html>
{% endblock %}
